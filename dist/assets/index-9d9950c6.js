(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const I="modulepreload",F=function(e,t){return new URL(e,t).href},T={},N=function(t,n,r){if(!n||n.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(n.map(o=>{if(o=F(o,r),o in T)return;T[o]=!0;const a=o.endsWith(".css"),f=a?'[rel="stylesheet"]':"";if(!!r)for(let u=s.length-1;u>=0;u--){const P=s[u];if(P.href===o&&(!a||P.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${f}`))return;const i=document.createElement("link");if(i.rel=a?"stylesheet":I,a||(i.as="script",i.crossOrigin=""),i.href=o,document.head.appendChild(i),a)return new Promise((u,P)=>{i.addEventListener("load",u),i.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>t()).catch(o=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o})};function V(e){return e.replace(/([^:]\/)\/+/g,"$1").replace(/^\/+/,"/")}var L=(e=>(e.POLY_PROGRESS="POLYProgress",e.SCENE_CREATED="POLYSceneCreated",e.SCENE_READY="POLYSceneReady",e.SCENE_PLAY="POLYScenePlay",e.SCENE_PAUSE="POLYScenePause",e.VIEWER_MOUNTED="POLYViewerMounted",e.VIEWER_READY="POLYViewerReady",e))(L||{});class k{static dispatchProgressEvent(t,n){const r=s=>new CustomEvent(s,{detail:{progress:t}});document.dispatchEvent(r(L.POLY_PROGRESS)),document.dispatchEvent(r(`${L.POLY_PROGRESS}-${n}`))}}const G={sceneData:{start:0,mult:.25},assets:{start:.25,mult:0},nodes:{start:.25,mult:.75}};var b=(e=>(e.EXPORT_MANIFEST="scene/export_manifest.json",e.CODE_PREFIX="scene/code",e.PROPERTIES="scene/code/properties.json",e.EDITOR="scene/editor.json",e.ASSETS="scene/assets.json",e.POLYGONJS="js/all.js",e.SCENE_DATA_LOADER="js/sceneDataLoader.js",e.POLY_CONFIG="js/polyConfig.js",e.JS_FILES="scene/js_files.json",e.POSTER="images/poster.png",e))(b||{});function W(e){const{urlPrefix:t,nodePath:n,shaderName:r,timestamp:s}=e;return`${t}/root/${n}.${r}.glsl?t=${s}`}function z(e){const{urlPrefix:t,nodePath:n,timestamp:r}=e;return`${t}/root/${n}.txt?t=${r}`}function U(e,t){const n=Object.keys(e.shaders);for(let r of n){const s=e.shaders[r],o=Object.keys(s);for(let a of o){const f=s[a];t({nodePath:r,shaderName:a,timestamp:f})}}}function B(e,t){const n=Object.keys(e.jsFunctionBodies);for(let r of n){const s=e.jsFunctionBodies[r];t({nodePath:r,timestamp:s})}}class X{static async importSceneData(t){t.editorMode==null&&(t.editorMode=!1);const n=t.manifest,r=t.urlPrefix||b.CODE_PREFIX,s=Object.keys(n.nodes),o=[];for(let c of s){const l=n.nodes[c],h=`${r}/root/${c}.json?t=${l}`;o.push(h)}const a=`${r}/root.json?t=${n.root}`,f=`${r}/properties.json?t=${n.properties}`,m=[a,f];if(t.editorMode){const c=Date.now();m.push(`${r}/ui.json?t=${c}`)}for(let c of o)m.push(c);const i=[];U(n,c=>{const l=W({urlPrefix:r,...c});m.push(l),i.push(l)});const u=[];B(n,c=>{const l=z({urlPrefix:r,...c});m.push(l),u.push(l)});let P=0;const g=m.length-(i.length+u.length),y=m.length;function R(){P++;const c=P/y,l=G.sceneData,h=l.start+l.mult*c;t.onProgress&&t.onProgress(h),k.dispatchProgressEvent(h,t.sceneName)}const M=m.map(c=>V(c)).map(c=>fetch(c)),D=await Promise.all(M),E=D.slice(0,g),v=D.slice(g),j=await Promise.all([...E.map(c=>(R(),c.json())),...v.map(c=>(R(),c.text()))]),p=j.slice(0,g),_=j.slice(g);let O=0;const d={};U(n,c=>{const l=_[O],{nodePath:h,shaderName:Y}=c;d[h]=d[h]||{},d[h][Y]=l,O++});const S={};B(n,c=>{const l=_[O],{nodePath:h}=c;S[h]=l,O++});const w={root:p[0],properties:p[1],shaders:d,jsFunctionBodies:S};let $=2;t.editorMode&&(w.ui=p[2],$+=1);const A={},x=Object.keys(n.nodes);for(let c=0;c<x.length;c++){const l=x[c],h=p[c+$];A[l]=h}return this.assemble(w,x,A)}static async assemble(t,n,r){const s={root:t.root,properties:t.properties,ui:t.ui,shaders:t.shaders,jsFunctionBodies:t.jsFunctionBodies};for(let o=0;o<n.length;o++){const a=n[o],f=r[a];this._insertChildData(s.root,a,f)}return s}static _insertChildData(t,n,r){const s=n.split("/");if(s.length==1)t.nodes||(t.nodes={}),t.nodes[n]=r;else{const o=s.shift(),a=s.join("/"),f=t.nodes[o];this._insertChildData(f,a,r)}}}const q={properties:"1721440066438",root:"1721399315933",nodes:{geo1:"1721439160823","geo1/clothSolver1":"1721399315933","geo1/MAT":"1721438995532","geo1/MAT/meshPhysical_CLOTH":"1721440059401","geo1/MAT/meshPhysicalBuilder1":"1721440059401","geo1/actor_clothSolver1":"1721438995532",lights:"1721399315933",cameras:"1721399315933","cameras/cameraControls1":"1721399315933",text:"1721439236092","text/MAT":"1721399315933"},shaders:{"/geo1/clothSolver1":{position:"1721399315933"},"/geo1/MAT/meshPhysical_CLOTH":{vertex:"1721399315933",fragment:"1721399315933","customDepthMaterial.vertex":"1721399315933","customDepthMaterial.fragment":"1721399315933","customDistanceMaterial.vertex":"1721399315933","customDistanceMaterial.fragment":"1721399315933","customDepthDOFMaterial.vertex":"1721399315933","customDepthDOFMaterial.fragment":"1721399315933"},"/geo1/MAT/meshPhysicalBuilder1":{vertex:"1721399315933",fragment:"1721399315933","customDepthMaterial.vertex":"1721399315933","customDepthMaterial.fragment":"1721399315933","customDistanceMaterial.vertex":"1721399315933","customDistanceMaterial.fragment":"1721399315933","customDepthDOFMaterial.vertex":"1721399315933","customDepthDOFMaterial.fragment":"1721399315933"}},jsFunctionBodies:{"/geo1/actor_clothSolver1":"1721399315933"}},H=async(e={})=>{const t=e.sceneDataRoot||"./polygonjs/scenes";return await X.importSceneData({sceneName:"scene_01",urlPrefix:t+"/scene_01",manifest:q,onProgress:e.onProgress})},J=async function(e={}){const{onProgress:t,domElement:n,configureSceneData:r,autoPlay:s,createViewer:o,printWarnings:a,renderer:f,cameraMaskOverride:m}=e;let i=e.sceneData;const u=e.baseUrl!=null?e.baseUrl:"./",P=e.sceneDataRoot!=null?e.sceneDataRoot:u+"/polygonjs/scenes",g=e.assetsRoot!=null?e.assetsRoot:u,y=e.libsRootPrefix!=null?e.libsRootPrefix:u,R=e.runRegister!=null?e.runRegister:!0,M=(e.loadModules!=null?e.loadModules:!0)?[]:[],D=[N(()=>import("./loadSceneFromSceneData-e5e4a379.js"),[],import.meta.url),i==null?H({onProgress:t,sceneDataRoot:P}):(()=>new Promise(d=>d()))()],E=await Promise.all(D),{Poly:v,loadSceneFromSceneData_scene_01:j}=E[0];i==null&&(i=E[1]),r&&r(i);const p=[];for(let d=2;d<E.length;d++)p.push(E[d]);let _=0;for(let d of M){const S=d+"Module";v.registerModule(p[_][S],a),_++}return await j({onProgress:t,sceneData:i,domElement:n,runRegister:R,autoPlay:s,createViewer:o,assetsRoot:g,libsRootPrefix:y,printWarnings:a,renderer:f,cameraMaskOverride:m})},K=async function(e={}){return e&&e.createViewer==null&&(e.createViewer=!0),J(e)};K({domElement:"app",baseUrl:"./"});export{L as P,k as a,G as b,V as s};
